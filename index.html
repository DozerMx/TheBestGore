<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TheForoBestGore - Inicio</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Contenedor principal -->
    <div class="container">
        <!-- Sección de bienvenida -->
        <div class="welcome-section">
            <h1>Bienvenido a TheForoBestGore</h1>
            <p>La comunidad donde puedes compartir y ver contenido exclusivo. Regístrate o inicia sesión para comenzar.</p>
            <div class="button-group">
                <button onclick="toggleForms('register')">Registrarse</button>
                <button onclick="toggleForms('login')">Iniciar Sesión</button>
            </div>
        </div>

        <!-- Formulario de Registro -->
        <div id="registerForm" class="form-section" style="display: none;">
            <h2>Registrarse</h2>
            <form id="register-form">
                <label for="email">Correo Electrónico:</label>
                <input type="email" id="email" placeholder="Ingresa tu correo" required>

                <label for="nick">Nick (Nombre de Usuario):</label>
                <input type="text" id="nick" placeholder="Ingresa un nombre de usuario" required>

                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Ingresa una contraseña segura" required>

                <button type="submit">Registrarse</button>
                <p>¿Ya tienes una cuenta? <span onclick="toggleForms('login')" class="link">Iniciar Sesión</span></p>
            </form>
        </div>

        <!-- Formulario de Inicio de Sesión -->
        <div id="loginForm" class="form-section" style="display: none;">
            <h2>Iniciar Sesión</h2>
            <form id="login-form">
                <label for="login-email">Correo Electrónico:</label>
                <input type="email" id="login-email" placeholder="Ingresa tu correo" required>

                <label for="login-password">Contraseña:</label>
                <input type="password" id="login-password" placeholder="Ingresa tu contraseña" required>

                <button type="submit">Iniciar Sesión</button>
                <p>¿No tienes una cuenta? <span onclick="toggleForms('register')" class="link">Registrarse</span></p>
            </form>
        </div>
    </div>

    <!-- Firebase App (la base principal de Firebase) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD9Do3nEXf2QQWr4dKzrk2oyr_UB3ByTlE",
            authDomain: "thebestgore-4bd6d.firebaseapp.com",
            databaseURL: "https://thebestgore-4bd6d-default-rtdb.firebaseio.com",
            projectId: "thebestgore-4bd6d",
            storageBucket: "thebestgore-4bd6d.appspot.com",
            messagingSenderId: "615685617268",
            appId: "1:615685617268:web:63c280e698eeaaf11b0321",
            measurementId: "G-SXYJ04BTPM"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Verificar si hay un usuario autenticado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Si hay un usuario autenticado, redirigir a home
                window.location.href = 'home.html';
            }
        });

        // Manejar el registro de usuarios
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const nick = document.getElementById('nick').value;

            try {
                // Crear el usuario en Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Guardar información adicional en la base de datos
                await set(ref(database, 'users/' + user.uid), {
                    nick: nick,
                    email: email,
                    profilePic: '',
                    createdAt: Date.now()
                });

                alert('Usuario registrado exitosamente');
                window.location.href = 'home.html';
            } catch (error) {
                let errorMessage = 'Error en el registro: ';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += 'El correo electrónico ya está registrado';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'El correo electrónico no es válido';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage += 'El registro de usuarios está deshabilitado';
                        break;
                    case 'auth/weak-password':
                        errorMessage += 'La contraseña es demasiado débil';
                        break;
                    default:
                        errorMessage += error.message;
                }
                alert(errorMessage);
            }
        });

        // Manejar el inicio de sesión
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                window.location.href = 'home.html';
            } catch (error) {
                let errorMessage = 'Error en el inicio de sesión: ';
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage += 'El correo electrónico no es válido';
                        break;
                    case 'auth/user-disabled':
                        errorMessage += 'Este usuario ha sido deshabilitado';
                        break;
                    case 'auth/user-not-found':
                        errorMessage += 'No existe un usuario con este correo';
                        break;
                    case 'auth/wrong-password':
                        errorMessage += 'Contraseña incorrecta';
                        break;
                    default:
                        errorMessage += error.message;
                }
                alert(errorMessage);
            }
        });
    </script>

    <script>
        // Función para mostrar u ocultar formularios
        function toggleForms(formType) {
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');

            if (formType === 'register') {
                registerForm.style.display = 'block';
                loginForm.style.display = 'none';
            } else {
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            }
        }
    </script>
</body>
</html>
